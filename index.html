<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AL CIELO – Consentimiento Informado</title>
<style>
body {background:#000;color:#fff;font-family:Arial;margin:0;padding:0;}
#legal-container {max-width:900px;margin:auto;background:#000;color:#fff;padding:20px;}
textarea {width:100%;height:320px;background:#111;color:#0f0;border:1px solid #333;padding:10px;resize:none;}
label {display:block;margin-top:15px;}
button {margin-top:20px;padding:15px;width:100%;background:#0056b3;color:white;border:none;font-size:18px;cursor:pointer;}
</style>
</head>
<body>
<div id="legal-container">
<h2>AL CIELO – CONSENTIMIENTO INFORMADO</h2>

<textarea readonly>
AL CIELO – BY MAY ROGA LLC
Propiedad legal y exclusiva de MAY ROGA LLC (USA)

[... aquí va todo el blindaje legal que me pasaste ...]
</textarea>

<label>
  <input type="checkbox" id="check-legal">
  Declaro que he leído, comprendido y acepto TODAS las condiciones legales
</label>

<button onclick="activarServicio()">ACEPTO Y ENTRAR AL SISTEMA</button>
</div>

<script>
async function activarServicio() {
  if(!document.getElementById("check-legal").checked){
    alert("Debe aceptar el consentimiento informado para continuar.");
    return;
  }

  const device_id = localStorage.getItem("device_id") || crypto.randomUUID();
  localStorage.setItem("device_id", device_id);

  const link_id = location.pathname.split("/").pop();

  const res = await fetch(`/activar/${link_id}`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({device_id, legal_ok:true})
  });

  const data = await res.json();
  if(res.ok){
    alert("Licencia activada. Descargando mapa y ruta necesaria para su viaje...");
    location.href = data.map_url;
  } else {
    alert(data.error || "Acceso denegado.");
  }
}
</script>
</body>
</html>
